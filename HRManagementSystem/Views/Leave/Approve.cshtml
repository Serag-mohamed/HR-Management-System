@model IEnumerable<HRManagementSystem.DTO.LeaveReportDto>
@using Microsoft.AspNetCore.Html
@{
    ViewData["Title"] = "Approve Leave Requests";
}

<div class="container mt-5">

    <h1 class="mb-4 text-primary">
        <i class="fas fa-check-circle me-2"></i> Approve Leave Requests
    </h1>
    <p class="text-muted">List of pending leave requests requiring action.</p>

    <hr />

    @if (Model == null || !Model.Any())
    {
        <div class="alert alert-success text-center shadow-sm">
            <i class="fas fa-thumbs-up me-2"></i> There are no pending leave requests to approve.
        </div>
    }
    else
    {
        <div class="table-responsive shadow-lg rounded-3">
            <table class="table table-striped table-hover align-middle">

                <thead class="bg-dark text-white">
                    <tr>
                        <th scope="col">@Html.DisplayNameFor(model => model.EmployeeName)</th>
                        <th scope="col">@Html.DisplayNameFor(model => model.PositionName)</th>
                        <th scope="col">@Html.DisplayNameFor(model => model.LeaveType)</th>
                        <th scope="col" class="text-nowrap">@Html.DisplayNameFor(model => model.StartDate)</th>
                        <th scope="col" class="text-nowrap">@Html.DisplayNameFor(model => model.EndDate)</th>
                        <th scope="col" class="text-center">Days</th>
                        <th scope="col" class="text-center">@Html.DisplayNameFor(model => model.Status)</th>
                        <th scope="col" class="text-center">Actions</th>
                    </tr>
                </thead>

                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td class="fw-bold">@item.EmployeeName</td>
                            <td>@item.PositionName</td>
                            <td>@item.LeaveType</td>

                            <td>@item.StartDate.ToString("yyyy-MM-dd")</td>
                            <td>@item.EndDate.ToString("yyyy-MM-dd")</td>

                            <td class="text-center fw-bold text-primary">@item.DaysNamer</td>

                            <td class="text-center">
                                @GetStatusBadge(item.Status)
                            </td>

                            <td class="text-center text-nowrap">
                                @if (item.Status == "Pending")
                                {
                                    <a asp-action="Accept"
                                       asp-route-id="@item.Id"
                                       class="btn btn-sm btn-success me-2"
                                       title="Approve">Accept
                                    </a>
                                    <a asp-action="Reject"
                                       asp-route-id="@item.Id"
                                       class="btn btn-sm btn-danger"
                                       title="Reject">Reject
                                    </a>
                                }
                                else
                                {
                                    <span class="badge bg-secondary">Action Taken</span>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</div>

@functions {
    public IHtmlContent GetStatusBadge(string status)
    {
        string cssClass = status switch
        {
            "Approved" => "bg-success",
            "Rejected" => "bg-danger",
            "Pending" => "bg-warning text-dark",
            _ => "bg-secondary"
        };
        return new HtmlString($"<span class=\"badge {cssClass}\">{status}</span>");
    }
}