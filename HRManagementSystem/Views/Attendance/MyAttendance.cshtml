@model IEnumerable<HRManagementSystem.DTO.AttendanceDto>

@{
	ViewData["Title"] = "My Attendance Records";
}

<div class="container mt-5">

	@if (TempData["Message"] != null)
	{
		<div class="alert alert-info alert-dismissible fade show shadow-sm" role="alert">
			<i class="fas fa-info-circle me-2"></i>
			<strong>@TempData["Message"]</strong>
			<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
		</div>
	}

	<h1 class="mb-4 text-primary">
		<i class="fas fa-calendar-check me-2"></i> My Attendance Records
	</h1>

	<hr class="mb-4" />

	<div class="d-flex justify-content-between align-items-center mb-4 p-3 bg-light rounded shadow-sm">

		<a asp-action="CheckIn" class="btn btn-success btn-lg">
			<i class="fas fa-sign-in-alt me-2"></i> Check In
		</a>

		<a asp-action="CheckOut" class="btn btn-danger btn-lg">
			<i class="fas fa-sign-out-alt me-2"></i> Check Out
		</a>
	</div>

	<div class="card shadow-lg">
		<div class="card-header bg-dark text-white">
			<h5 class="mb-0">Monthly Attendance History</h5>
		</div>
		<div class="card-body p-0">
			<div class="table-responsive">
				<table class="table table-striped table-hover mb-0">
					<thead class="table-dark">
						<tr>
							<th>
								@Html.DisplayNameFor(model => model.Date)
							</th>
							<th>
								@Html.DisplayNameFor(model => model.CheckInTime)
							</th>
							<th>
								@Html.DisplayNameFor(model => model.CheckOutTime)
							</th>
							<th>
								<i class="fas fa-clock me-1"></i> @Html.DisplayNameFor(model => model.TotalHoursWorked)
							</th>
						</tr>
					</thead>
					<tbody>
						@if (Model.Any())
						{
							@foreach (var item in Model)
							{
								<tr>
									<td>
										<span class="badge bg-info text-dark fw-bold">
											@* 💡 عرض التاريخ فقط (ToShortDateString) *@
											@if (item.Date is DateTime dt)
											{
												@(dt.ToShortDateString())
											}
											else
											{
												@Html.DisplayFor(modelItem => item.Date)
											}
										</span>
									</td>
									<td>
										@* 💡 عرض وقت الدخول (TimeSpan) بصيغة HH:mm *@
										@if (item.CheckInTime is TimeSpan tsIn)
										{
											@(tsIn.ToString(@"hh\:mm"))
										}
										else
										{
											@Html.DisplayFor(modelItem => item.CheckInTime)
										}
									</td>
									<td>
										@if (item.CheckOutTime.HasValue)
										{
											@* 💡 عرض وقت الخروج (Nullable TimeSpan) بصيغة HH:mm *@
											@if (item.CheckOutTime.Value is TimeSpan tsOut)
											{
												@(tsOut.ToString(@"hh\:mm"))
											}
											else
											{
												@Html.DisplayFor(modelItem => item.CheckOutTime)
											}
										}
										else
										{
											<span class="text-warning fw-bold">PENDING</span>
										}
									</td>
									<td>
										@if (item.TotalHoursWorked > 0)
										{
											<span class="fw-bold">
												@item.TotalHoursWorked.ToString("F1") Hour
											</span>
										}
										else
										{
											<span class="text-muted">N/A</span>
										}
									</td>

								</tr>
							}
						}
						else
						{
							<tr>
								<td colspan="4" class="text-center text-muted py-4">
									<i class="fas fa-info-circle me-1"></i> No attendance records found.
								</td>
							</tr>
						}
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>